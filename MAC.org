#+INCLUDE: "preamble.org"

#+TITLE: Medium Access Control 
#+AUTHOR: Mo, Yilin
#+DATE: Oct 2020 

#+KEYWORDS: Medium Access Control
#+DESCRIPTION: MAC layer for iot course

#+BEGIN_SRC ipython :session :exports none
from bokeh.resources import CDN
from bokeh.plotting import figure, show
from bokeh.embed import autoload_static
from bokeh.layouts import gridplot
from bokeh.models import Range1d
from numpy import *
from bokeh.palettes import Category10_10

width = 1200
height = 600


def step_func(x, x0, y0):
    index = argsort(abs(x - 0.5 - x0))[0]
    return y0[index]
#+END_SRC

#+RESULTS:
: # Out[1]:
* Introduction

** Core Questions

- What purpose does the data link layer serve in OSI network model?
- How does collision occur in wireless communication?
  - What are hidden and exposed terminal problem?
- What are the major categories for medium access control protocols? 
- How to save energy in the MAC protocol?
   
** Learning Objectives
- Definition of the data link layer in the OSI network model
  - Medium Access Control
  - Logical Link Control
- Characteristics of collision problem in wireless communication
  - Hidden terminal problem
  - Exposed terminal problem
- MAC layer protocols
  - Deterministic access
  - Ordered access
  - Random access

** Table of Contents
   :PROPERTIES:
   :UNNUMBERED: notoc
   :END:
#+REVEAL_TOC: headlines 1

* Overview

** OSI 7-Layer Network Model

    {{{revealimg("./figures/osimodel.meta",t,"60vh")}}}

*** Data-Link Layer
- Physical Layer: handles transmission of raw bits
- What is not taken care of...
  - Handling collision
  - Multiplexing
  - Error checking
  - Framing

*** Data-Link Layer

- Logical Link Control (LLC)
  - IEEE 802.2 standard
  - recognizing where frames begin and end in the bit-stream
  - (de)multiplexing different protocols to be transmitted over the MAC layer
  - optionally providing flow control, and detection and retransmission of dropped frames
    - Usually provided by transport layer protocols (TCP) in an end-to-end fashion
- Medium/Media Access Control (MAC)

*** What is MAC?

- Defines how a node obtains a channel when it needs to
  - Determines who gets to send data at any given time
  - Avoid Collision

*** Design Considerations

- What kind of a resource do we have?
  - Frequency: bandwidth
  - Time: Latency
  - Energy
- How much does a node need?
  - How often?
  - How regular? Is the communication bursty or not?
- What kind of a "guarantee" should be provided?
- Do we need central control or "let things happen as they may"?
- Complexity/Fairness/...

** The Collision Problem in Wireless Communications

- Two nodes send to the same node at the same time
- Interference of data: data loss

*** Ethernet vs. Wireless

- Ethernet
  - Medium is clear
    - if you sense no carrier, there is no one sending data on the wire
  - Node can send and receive at the same time
- Wireless LAN
  - Medium is not clear
      - possible that some node is sending data but is out of your range
  - Cannot send and receive at the same time
      - (assuming a single frequency)

*** The "Hidden Terminal" Problem
- Station C is sending data to station B. 
- Station A wants to do the same and listens for other frames being sent. 
- Since A is *out of the range* of station C, it does *NOT* notice its frames and thinks the media is free. 
- A and C transmit simultaneously to B, and B loses *both* frames.

    {{{revealimg("./figures/hiddennode.meta",t,"40vh")}}}

*** The "Exposed Terminal" Problem

- The two transmitters (S1, S2) in the middle are in range of each other. 
- The two receivers (R1, R2) are out of range of each other
- If a transmission between S1 and R1 is taking place:
  - However, S2 can "hear" S1’s transmission
  - S2 concludes that it will interfere with  S1
  - So S2 chooses *NOT* to transmit
- However R1 cannot hear S2 and R2 cannot hear S1.

  {{{revealimg("./figures/exposednode.meta",t,"40vh")}}}

*** Wasted Energy in Communication

- Collisions
  - Packets become corrupted
  - Expend more energy for re-transmission
- Overhearing
  - Receiving a packet intended for another node
  - Expend energy receiving a packet that is useless
- Control Packet Overhead
  - Large overhead translates into sending larger packets or more packets, and therefore more energy expended
- Idle Listening
  - Waiting to receive a packet
  - Receiver expends energy and receives no data
  - #1 source of wasted energy

*** Collision Problem (Wireless Version)

- Collision cannot be sensed when transmitting
- Hidden Terminal problem
- Exposed Terminal problem
- Energy concern 

** Types of MAC

- Ordered Access
- Deterministic Access
  - Some of the protocols are in the physical layer
- Random Access
- Hybrid

* Ordered Access

** Ordered Access

- Not random
- Not controlled by a central control point that allocates channels
- Token Ring 
  - Introduced by IBM in 1984
  - Standardized in 1989 as IEEE 802.5
  - Was successful in corporate environments 
  - Taken over by Ethernet (Random Access)

*** Token Passing

- Only the system which has some "token" can communicate {{{reveallicense("./figures/ibmmau.meta","20vh")}}}
- Token is passed to the next candidate in a sequential manner
  {{{revealimg("./figures/tokenring.meta",t,"50vh")}}}


*** Problems with Ordered Access

- How about in a wireless network?
  - Nodes might leave?
  - Break the Order
  - Take away the token

* Deterministic Access
** Deterministic Access
- Controlled by a central control point that allocates channels
  - Time Division Multiple Access (TDMA)
  - Frequency Division Multiple Access (FDMA)
  - Space Division Multiple Access (SDMA)
  - Code Division Multiple Access (CDMA)
- Requires access points for coordination

** Frequency Division & Time Division 

- Frequency Division Duplexing (FDD)
  - Two distinct frequencies at the same time for the two directions
  - Capacity is determined by frequency band allocation, making it difficult to make a dynamic change.
- Time Division Duplexing (TDD)
  - Two distinct sets of time slots on the same frequency for the two directions
  - Cheaper since without the need of a diplexer to isolate transmission and receptions.
  - Possible to change the uplink and downlink capacity ratio dynamically according to the needs.
  - Time latency because only half-duplex
  - Guard period is necessary
- Both are used in 4G (not compatible)
  - China Unicom, Telecom: FDD
  - China Mobile: TDD -> FDD

*** Time Division Multiple Access (TDMA)

- Multiple users share the same frequency band via cyclically repeating "time slots"
  - particular time slot re-occurring every frame of N slots
  - Transmission for any user is non-continuous: buffer-and-burst digital data & modulation needed, lower battery consumption
  - Larger overhead: synchronization bits for each data burst, guard bits for variations in propagation delay and delay spread

*** Frequency Division Multiple Access (FDMA)

- Assign different frequency bands to individual users
  - Available spectrum is divided into a number of “narrowband” channels
  - Frequency band assigned to users who request service

*** LTE Resource Block cite:Lea2018
  {{{revealimg("./figures/lteresouceblock.meta","LTE Resource Block","40vh",nil,'none)}}}

*** LTE Resource Block
- Each LTE frame is 10ms and 20MHz, 2MHz of which are used as guard band.
- A resource block of 180kHz and 0.5ms can be allocated to each user.
- \( (20-2)/0.18 \times 10/0.5 = 2000 \) resource blocks in 1 frame.
- Each resource block is further divided into \(12\times 15Khz \) subcarriers.
- 7 OFDM symbols can be transmitted by 1 subcarrier in one block (\(0.5 ms \times 15kHz\))
- 1 resource block can transmit 84 OFDM symbols
- \(84\times 2000 = 168k\) OFDM symbols can be transmitted in 1 frame 
- The symbol rate is 16.8M/s
- Assuming 16-QAM, the raw bit rate is \(16.8\times \log_216 = 67.2Mbps\).
** Code Division Multiple Access (CDMA)
- Exploits mathematical properties of orthogonality



** Space Division Multiple Access (SDMA)
- Traditional mobile network has no information on the position of the mobile units 
  - Hence, the signal is transmitted in all directions 
  - Likewise, in reception, the antenna receives signals coming from all directions 
    - including interference signals.
- For SDMA, the antenna, both in transmission and reception, is adapted to each user to obtain highest gain in the direction of that user.
  - This is often done using phased array techniques.
* Contention-Based

** Random Access

- Randomly access media, usually detect collision *after* it happens
  - ALOHA
  - Carrier Sense Multiple Access (CSMA)
  - Carrier Sense Multiple Access w/ Collision Detection (CSMA/CD)
  - Carrier Sense Multiple Access w/ Collision Avoidance (CSMA/CA)

** ALOHA 

- A node can transmit as soon as it has a packet to send
- Each node acts independently
- Interference occurs when two or more nodes transmit concurrently
- Simple but not quite efficient 

*** ALOHA

** Carrier Sense Multiple Access (CSMA)

- Verifies the absence of other traffic before transmitting
- If a carrier is sensed, the node waits for the transmission in progress to finish before initiating its own transmission.
- However, if two nodes try to send a frame at nearly the same time, neither detects a carrier so both begin transmitting.

** Carrier Sense Multiple Access w/ Collision Detection (CSMA/CD)

- Sending nodes are able to detect when a collision occurs and stop transmitting immediately, backing off for a random amount of time before trying again
- Used in Ethernet
- Does not work in Wireless
  - hidden node problem
  - cannot send and receive at the same time

** Carrier Sense Multiple Access w/ Collision Avoidance (CSMA/CA)

- IEEE 802.11 Standard
- First, listen to the channel for a pre-determined amount of time so as to check for any activity on the channel
- If the channel is sensed “idle”, then the station is permitted to transmit
- If the channel is sensed as "busy" the station has to delay its transmission, avoiding collision
- This virtual carrier sensing is done by a four-way handshake

*** CSMA/CA

todo

*** Hidden Terminal Problem

- Partially solves the hidden node problem
- T will get to know about the activity of H from CTS packet of R
- RTS packet is small (low cost of collision)


** Design Considerations

*** Random Access
- Carrier sense or not?
  - What is the probability of "hearing someone is talking"?
- Slotted or Unslotted?
- Cost of collision v.s. cost of overhead?

*** Deterministic v.s. Random

#+BEGIN_leftcol
- Deterministic Access
  - High throughput when traffic is heavy
  - Small delay variance
  - Relatively larger overhead of processing
#+END_leftcol
#+BEGIN_rightcol
- Random Access
  - Small overhead of processing
  - Too many collisions when traffic is heavy: throughput decreases with load
  - May subject to large delays
#+END_rightcol

*** Deterministic v.s. Random
todo

*** MAC Layer for Various Wireless Protocols
    
| 4G LTE        | TDMA and FDMA               |
| IEEE 802.11   | CSMA/CA                     |
| Bluetooth     | FHSS + (CSMA/CA or TDMA)    |
| IEEE 802.15.4 | (CSMA/CA + TDMA) or CSMA/CA |
| LoRa          | Unslotted ALOHA             |

* Hybrid Solution: IEEE 802.15.4


   
* Bibliography
  :PROPERTIES:
  :CUSTOM_ID: bibliography
  :END:

  printbibliography:references.bib

  # Local Variables:
  # indent-tabs-mode: nil
  # org-src-preserve-indentation: t
  # End:
